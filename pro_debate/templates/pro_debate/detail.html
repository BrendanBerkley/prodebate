{% extends 'base.html' %}

{% block content %}
	<div class="col-xs-12">
		{% if parent %}
			<h3>
				<a href="{% url 'detail' parent.id %}{% if grandparent %}?parent={{ grandparent }}{% endif %}">
					<i class="fa fa-angle-up"></i> {{ parent }}
				</a>
			</h3>
		{% endif %}

		<h2>
			{% if parent %}
				<small style="display: inline-block; padding-bottom: 7px;">{{ elaboration_in_tree.get_tree_relation_display }}</small><br />
			{% endif %}
			{{ position.position_statement }}
		</h2>

		<div class="row">
		{% if parent %}
			<div class="{% if elaborations_in_other_trees %}col-sm-8{% else %}col-xs-12{% endif %}">
				<p class="lead">
					{{ elaboration_in_tree.elaboration }}
				</p>
			</div>
			{% if elaborations_in_other_trees %}
			<div class="col-sm-4">
				<div class="well">
					<h4>In other trees</h4>
					<ul>
					{% for elaboration in elaborations_in_other_trees %}
						<li>
							<em>{{ elaboration.get_tree_relation_display }}</em> for
							<a href="{% url 'detail' elaboration.elaborates.id %}?parent={{ elaboration.child_of.id }}">{{ elaboration.child_of }}</a>
						</li>
					{% endfor %}
					</ul>
				</div>
			</div>
			{% endif %}
		{% else %}
			<div class="col-xs-12">
			{% if elaboration_in_tree %}
				<p class="lead">{{ elaboration_in_tree.elaboration }}</p>
			{% endif %}

			{% if elaborations_in_other_trees %}
				<div class="well">
					<h4>This argument can be found in the following trees:</h4>
					<ul>
					{% for elaboration in elaborations_in_other_trees %}
						<li>
							<em>{{ elaboration.get_tree_relation_display }}</em> for
							<a href="{% url 'detail' elaboration.elaborates.id %}?parent={{ elaboration.child_of.id }}">{{ elaboration.child_of }}</a>
						</li>
					{% endfor %}
					</ul>
				</div>
			{% endif %}
			</div>
		{% endif %}

		</div>
		<br />

		<h3>Supporting points</h3>
		<ul>
		{% for child in support_points %}
			<li>
				<a href="{% url 'detail' child.elaborates.id %}?parent={{ child.child_of.id }}{% if parent %}&amp;grandparent={{ parent.id }}{% endif %}">
					<h4>{{ child.elaborates }}</h4>
				</a>
			</li>
		{% endfor %}
		</ul>


		{% if user.is_authenticated %}
		<div>
			<a class="btn btn-default" data-toggle="collapse" href="#support-collapse">
				<i class="fa fa-plus"></i> Add a Supporting point
			</a>
		</div>

		<div class="collapse" id="support-collapse">
			<form action="{% url 'submit' position.id %}" method="post">
				{% csrf_token %}
				<div class="form-group">
					<label for="position">What's your point?</label> 
					<input class="form-control" type="text" name="position" />
				</div>
				<div class="form-group">
					<label for="elaboration">Tell me more.</label> 
					<textarea class="form-control" name="elaboration"></textarea>
				</div>
				<input type="hidden" name="tree_relation" value="S" />
				<input type="hidden" name="child_of" value="{{ position.id }}" />
				<input type="hidden" name="grandchild_of" value="{{ parent.id }}" />
				<input class="btn btn-primary" type="submit" value="Submit" />
			</form>
		</div>
		{% endif %}

		<h3>Counterpoints</h3>
		<ul>
		{% for child in counter_points %}
			<li>
				<a href="{% url 'detail' child.elaborates.id %}?parent={{ child.child_of.id }}{% if parent %}&amp;grandparent={{ parent.id }}{% endif %}">
					<h4>{{ child.elaborates }}</h4>
				</a>
			</li>
		{% endfor %}
		</ul>

		{% if user.is_authenticated %}
		<div>
			<a class="btn btn-default" data-toggle="collapse" href="#counter-collapse">
				<i class="fa fa-plus"></i> Add a Counterpoint
			</a>
		</div>

		<div class="collapse" id="counter-collapse">
			<form action="{% url 'submit' position.id %}" method="post">
				{% csrf_token %}
				<div class="form-group">
					<label for="position">What's your point?</label> 
					<input class="form-control" type="text" name="position" />
				</div>
				<div class="form-group">
					<label for="elaboration">Tell me more.</label> 
					<textarea class="form-control" name="elaboration"></textarea>
				</div>
				<input type="hidden" name="tree_relation" value="C" />
				<input type="hidden" name="child_of" value="{{ position.id }}" />
				<input type="hidden" name="grandchild_of" value="{{ parent.id }}" />
				<input class="btn btn-primary" type="submit" value="Submit" />
			</form>
		</div>
		{% endif %}
					

		<br /><br />

		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Manifestations</h3>
			</div>
			<ul class="list-group">
			{% for manifestation in position.manifestation_set.all %}
				<li class="list-group-item">
					<h4><a href="{{ manifestation.url }}">{{ manifestation.title }}</a></h4>
					<blockquote>
						{{ manifestation.notes }}
					</blockquote>
				</li>
			{% endfor %}
				<li class="list-group-item">
					{% if user.is_authenticated %}
					<a class="btn btn-default" data-toggle="collapse" href="#manifestation-collapse">
						<i class="fa fa-plus"></i> Add a Manifestation
					</a>
					<br /><br />
					<div class="collapse" id="manifestation-collapse">
						<form action="{% url 'submit_manifestation' position.id %}" method="post">
							{% csrf_token %}
							<div class="form-group">
								<label for="url">URL</label> 
								<input class="form-control" type="text" id="url" name="url" />
							</div>
							<div class="form-group">
								<label for="title">Title</label> 
								<input class="form-control" type="text" id="title" name="title" />
							</div>
							<div class="form-group">
								<label for="notes">Notes</label> 
								<textarea class="form-control" id="notes" name="notes"></textarea>
							</div>
							<input type="hidden" name="parent" value="{{ parent.id }}" />
							<input type="hidden" name="grandparent" value="{{ grandparent }}" />
							<input class="btn btn-primary" type="submit" value="Submit" />
						</form>
					</div>
					{% endif %}
				</li>
			</ul>
		</div>
	</div>



{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


{% endblock %}